<%= partial :search_header, :page => page %>
<css>
  
  .well-transparent {
    background-color: transparent;
  }
  #sync-ok {
    color: rgb(166, 206, 57);
    font-size: 1.4em;
    display: none;
  }


</css>
<div class="row-fluid">
  <div class="span2"></div>
  <div class="span8">
    <div class="page-header">
      <h2>Synchronize with ORCID</h2>
    </div>
    <div class="well well-large">
      <div class="pull-right">
        <i class="icon-ok lead" id="sync-ok"></i>
        <button class="btn btn-warning" id="sync-button">
          <i class="icon-refresh" id="sync-icon"></i>
          Sync with ORCID
        </button>
      </div>
      <span class="lead">
        Sync changes from your ORCID profile to this site
      </span>
    </div>
  </div>
</div>
<%= partial :search_footer, :page => page %>
<script>
  
  $(document).ready(function() {
    var performSync = function() {
      $.ajax({url: '/orcid/sync',
              success: function(data) {
                if (data['status'] == 'oauth_timeout') {
                  $.oauthpopup({path: '/auth/orcid',
                                callback: function() {
                                  performSync();
                                }});  
                } else {
                  $('#sync-icon').removeClass('icon-spin');
                  $('#sync-button').removeClass('disabled');
                }

                if (data['status'] == 'ok') {
                  $('#sync-ok').show().delay(1000).fadeOut();
                }
              },
              error: function() {
                $('#sync-icon').removeClass('icon-spin');
                $('#sync-button').removeClass('disabled');
              }
      });
    }
    
    $('#sync-button').click(function(e) {
      if ($(this).hasClass('disabled')) {
        return;
      }
      
      $('#sync-icon').addClass('icon-spin');
      $(this).addClass('disabled');
      performSync();
      
      e.preventDefault();
      return false;
    });
  });


</script>
